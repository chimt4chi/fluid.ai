<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>‚ú® Task Board</title>
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>
    <style>
        * { font-family: 'Inter', sans-serif; }

        @keyframes slideIn {
            from { opacity: 0; transform: translateY(-10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        @keyframes fadeOut {
            from { opacity: 1; transform: scale(1); }
            to { opacity: 0; transform: scale(0.8); }
        }

        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }

        @keyframes shimmer {
            0% { background-position: -200% 0; }
            100% { background-position: 200% 0; }
        }

        .task-enter { animation: slideIn 0.3s ease-out; }
        .task-exit { animation: fadeOut 0.3s ease-out; }
        .pulse { animation: pulse 0.5s ease-in-out; }

        .shimmer {
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.4), transparent);
            background-size: 200% 100%;
            animation: shimmer 2s infinite;
        }

        .glass {
            background: rgba(255, 255, 255, 0.85);
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
        }

        .priority-high { border-left: 4px solid #ef4444; }
        .priority-medium { border-left: 4px solid #f59e0b; }
        .priority-low { border-left: 4px solid #22c55e; }

        .checkbox-custom {
            appearance: none;
            width: 22px;
            height: 22px;
            border: 2px solid #d1d5db;
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.2s;
        }

        .checkbox-custom:checked {
            background: linear-gradient(135deg, #6366f1 0%, #8b5cf6 100%);
            border-color: #6366f1;
            background-image: url("data:image/svg+xml,%3csvg viewBox='0 0 16 16' fill='white' xmlns='http://www.w3.org/2000/svg'%3e%3cpath d='M12.207 4.793a1 1 0 010 1.414l-5 5a1 1 0 01-1.414 0l-2-2a1 1 0 011.414-1.414L6.5 9.086l4.293-4.293a1 1 0 011.414 0z'/%3e%3c/svg%3e");
        }

        .gradient-bg {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 50%, #f093fb 100%);
            min-height: 100vh;
        }
    </style>
</head>
<body class="gradient-bg">
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useCallback, useRef } = React;

        // API Base URL
        const API_URL = '/api';

        // Category configurations with icons and colors
        const CATEGORIES = {
            general: { label: 'üìã General', color: 'bg-gray-100 text-gray-700' },
            work: { label: 'üíº Work', color: 'bg-blue-100 text-blue-700' },
            personal: { label: 'üè† Personal', color: 'bg-green-100 text-green-700' },
            health: { label: 'üí™ Health', color: 'bg-pink-100 text-pink-700' },
            learning: { label: 'üìö Learning', color: 'bg-purple-100 text-purple-700' }
        };

        // Priority configurations
        const PRIORITIES = {
            low: { label: 'Low', color: 'text-green-600', bg: 'bg-green-50' },
            medium: { label: 'Medium', color: 'text-amber-600', bg: 'bg-amber-50' },
            high: { label: 'High', color: 'text-red-600', bg: 'bg-red-50' }
        };

        // Confetti celebration
        const triggerCelebration = () => {
            const duration = 3000;
            const end = Date.now() + duration;

            const frame = () => {
                confetti({
                    particleCount: 3,
                    angle: 60,
                    spread: 55,
                    origin: { x: 0 },
                    colors: ['#6366f1', '#8b5cf6', '#f093fb', '#22c55e']
                });
                confetti({
                    particleCount: 3,
                    angle: 120,
                    spread: 55,
                    origin: { x: 1 },
                    colors: ['#6366f1', '#8b5cf6', '#f093fb', '#22c55e']
                });

                if (Date.now() < end) {
                    requestAnimationFrame(frame);
                }
            };
            frame();
        };

        // Progress Bar Component
        const ProgressBar = ({ progress }) => {
            const prevProgress = useRef(0);
            const isComplete = progress.percentage === 100 && progress.total > 0;

            useEffect(() => {
                if (isComplete && prevProgress.current < 100) {
                    triggerCelebration();
                }
                prevProgress.current = progress.percentage;
            }, [progress.percentage, isComplete]);

            return (
                <div className="mb-6">
                    <div className="flex justify-between items-center mb-2">
                        <span className="text-sm font-medium text-gray-600">
                            Progress: {progress.completed} / {progress.total} tasks
                        </span>
                        <span className={`text-lg font-bold ${isComplete ? 'text-green-500' : 'text-indigo-600'}`}>
                            {progress.percentage}%
                            {isComplete && ' üéâ'}
                        </span>
                    </div>
                    <div className="w-full h-3 bg-gray-200 rounded-full overflow-hidden">
                        <div 
                            className={`h-full rounded-full transition-all duration-500 ease-out ${
                                isComplete 
                                    ? 'bg-gradient-to-r from-green-400 to-emerald-500' 
                                    : 'bg-gradient-to-r from-indigo-500 to-purple-500'
                            }`}
                            style={{ width: `${progress.percentage}%` }}
                        >
                            {progress.percentage > 20 && (
                                <div className="shimmer w-full h-full"></div>
                            )}
                        </div>
                    </div>
                </div>
            );
        };

        // Task Input Component
        const TaskInput = ({ onAddTask, loading }) => {
            const [title, setTitle] = useState('');
            const [priority, setPriority] = useState('medium');
            const [category, setCategory] = useState('general');
            const [isExpanded, setIsExpanded] = useState(false);

            const handleSubmit = async (e) => {
                e.preventDefault();
                if (title.trim()) {
                    await onAddTask({ title, priority, category });
                    setTitle('');
                    setPriority('medium');
                    setCategory('general');
                }
            };

            return (
                <form onSubmit={handleSubmit} className="mb-6">
                    <div className="flex gap-2 mb-3">
                        <input
                            type="text"
                            value={title}
                            onChange={(e) => setTitle(e.target.value)}
                            onFocus={() => setIsExpanded(true)}
                            placeholder="‚ú® What needs to be done?"
                            className="flex-1 px-4 py-3 rounded-xl border-2 border-gray-200 focus:border-indigo-400 focus:outline-none transition-all text-gray-700 placeholder-gray-400"
                            disabled={loading}
                        />
                        <button
                            type="submit"
                            disabled={!title.trim() || loading}
                            className="px-6 py-3 bg-gradient-to-r from-indigo-500 to-purple-500 text-white rounded-xl font-medium hover:from-indigo-600 hover:to-purple-600 disabled:opacity-50 disabled:cursor-not-allowed transition-all transform hover:scale-105 active:scale-95 shadow-lg shadow-indigo-200"
                        >
                            {loading ? '...' : '+ Add'}
                        </button>
                    </div>

                    {isExpanded && (
                        <div className="flex gap-4 flex-wrap task-enter">
                            <div className="flex items-center gap-2">
                                <span className="text-sm text-gray-500">Priority:</span>
                                {Object.entries(PRIORITIES).map(([key, val]) => (
                                    <button
                                        key={key}
                                        type="button"
                                        onClick={() => setPriority(key)}
                                        className={`px-3 py-1 rounded-lg text-sm font-medium transition-all ${
                                            priority === key 
                                                ? `${val.bg} ${val.color} ring-2 ring-offset-1 ring-${key === 'high' ? 'red' : key === 'medium' ? 'amber' : 'green'}-300` 
                                                : 'bg-gray-100 text-gray-500 hover:bg-gray-200'
                                        }`}
                                    >
                                        {val.label}
                                    </button>
                                ))}
                            </div>

                            <div className="flex items-center gap-2">
                                <span className="text-sm text-gray-500">Category:</span>
                                <select
                                    value={category}
                                    onChange={(e) => setCategory(e.target.value)}
                                    className="px-3 py-1 rounded-lg text-sm border border-gray-200 focus:outline-none focus:ring-2 focus:ring-indigo-200"
                                >
                                    {Object.entries(CATEGORIES).map(([key, val]) => (
                                        <option key={key} value={key}>{val.label}</option>
                                    ))}
                                </select>
                            </div>
                        </div>
                    )}
                </form>
            );
        };

        // Single Task Component
        const TaskItem = ({ task, onToggle, onDelete, loading }) => {
            const [isDeleting, setIsDeleting] = useState(false);
            const categoryConfig = CATEGORIES[task.category] || CATEGORIES.general;
            const priorityConfig = PRIORITIES[task.priority] || PRIORITIES.medium;

            const handleDelete = async () => {
                setIsDeleting(true);
                setTimeout(() => onDelete(task.id), 300);
            };

            return (
                <div 
                    className={`group glass rounded-xl p-4 mb-3 shadow-sm hover:shadow-md transition-all priority-${task.priority} ${
                        isDeleting ? 'task-exit' : 'task-enter'
                    } ${task.completed ? 'opacity-70' : ''}`}
                >
                    <div className="flex items-center gap-3">
                        <input
                            type="checkbox"
                            checked={task.completed}
                            onChange={() => onToggle(task.id)}
                            disabled={loading}
                            className="checkbox-custom"
                        />

                        <div className="flex-1 min-w-0">
                            <p className={`font-medium text-gray-800 ${task.completed ? 'line-through text-gray-400' : ''}`}>
                                {task.title}
                            </p>
                            <div className="flex items-center gap-2 mt-1">
                                <span className={`text-xs px-2 py-0.5 rounded-full ${categoryConfig.color}`}>
                                    {categoryConfig.label}
                                </span>
                                <span className={`text-xs ${priorityConfig.color}`}>
                                    ‚Ä¢ {priorityConfig.label}
                                </span>
                            </div>
                        </div>

                        <button
                            onClick={handleDelete}
                            disabled={loading}
                            className="opacity-0 group-hover:opacity-100 p-2 text-gray-400 hover:text-red-500 hover:bg-red-50 rounded-lg transition-all"
                            title="Delete task"
                        >
                            <svg className="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16" />
                            </svg>
                        </button>
                    </div>
                </div>
            );
        };

        // Category Filter Component (Unique Feature Enhancement)
        const CategoryFilter = ({ categoryStats, activeFilter, onFilterChange }) => {
            return (
                <div className="flex flex-wrap gap-2 mb-4">
                    <button
                        onClick={() => onFilterChange(null)}
                        className={`px-3 py-1.5 rounded-lg text-sm font-medium transition-all ${
                            !activeFilter 
                                ? 'bg-indigo-500 text-white shadow-md' 
                                : 'bg-gray-100 text-gray-600 hover:bg-gray-200'
                        }`}
                    >
                        All
                    </button>
                    {Object.entries(CATEGORIES).map(([key, val]) => {
                        const stats = categoryStats[key];
                        if (!stats) return null;
                        return (
                            <button
                                key={key}
                                onClick={() => onFilterChange(key)}
                                className={`px-3 py-1.5 rounded-lg text-sm font-medium transition-all ${
                                    activeFilter === key 
                                        ? 'bg-indigo-500 text-white shadow-md' 
                                        : `${val.color} hover:opacity-80`
                                }`}
                            >
                                {val.label} ({stats.completed}/{stats.total})
                            </button>
                        );
                    })}
                </div>
            );
        };

        // Empty State Component
        const EmptyState = () => (
            <div className="text-center py-12">
                <div className="text-6xl mb-4">üìù</div>
                <h3 className="text-xl font-semibold text-gray-700 mb-2">No tasks yet!</h3>
                <p className="text-gray-500">Add your first task to get started</p>
            </div>
        );

        // Main App Component
        const App = () => {
            const [tasks, setTasks] = useState([]);
            const [progress, setProgress] = useState({ percentage: 0, completed: 0, total: 0 });
            const [categoryStats, setCategoryStats] = useState({});
            const [loading, setLoading] = useState(false);
            const [error, setError] = useState(null);
            const [activeFilter, setActiveFilter] = useState(null);

            // Fetch tasks
            const fetchTasks = useCallback(async () => {
                try {
                    const response = await fetch(`${API_URL}/tasks`);
                    const data = await response.json();
                    setTasks(data.tasks);
                    setProgress(data.progress);
                    setCategoryStats(data.category_stats);
                } catch (err) {
                    setError('Failed to fetch tasks');
                    console.error(err);
                }
            }, []);

            useEffect(() => {
                fetchTasks();
            }, [fetchTasks]);

            // Add task
            const handleAddTask = async (taskData) => {
                setLoading(true);
                try {
                    const response = await fetch(`${API_URL}/tasks`, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify(taskData)
                    });
                    const data = await response.json();
                    setTasks(prev => [data.task, ...prev]);
                    setProgress(data.progress);
                    await fetchTasks(); // Refresh stats
                } catch (err) {
                    setError('Failed to add task');
                } finally {
                    setLoading(false);
                }
            };

            // Toggle task
            const handleToggleTask = async (taskId) => {
                try {
                    const response = await fetch(`${API_URL}/tasks/${taskId}/toggle`, {
                        method: 'PUT'
                    });
                    const data = await response.json();
                    setTasks(prev => prev.map(t => t.id === taskId ? data.task : t));
                    setProgress(data.progress);
                    await fetchTasks(); // Refresh stats
                } catch (err) {
                    setError('Failed to update task');
                }
            };

            // Delete task
            const handleDeleteTask = async (taskId) => {
                try {
                    const response = await fetch(`${API_URL}/tasks/${taskId}`, {
                        method: 'DELETE'
                    });
                    const data = await response.json();
                    setTasks(prev => prev.filter(t => t.id !== taskId));
                    setProgress(data.progress);
                    await fetchTasks(); // Refresh stats
                } catch (err) {
                    setError('Failed to delete task');
                }
            };

            // Clear completed
            const handleClearCompleted = async () => {
                try {
                    await fetch(`${API_URL}/tasks`, { method: 'DELETE' });
                    await fetchTasks();
                } catch (err) {
                    setError('Failed to clear completed tasks');
                }
            };

            // Filter tasks
            const filteredTasks = activeFilter 
                ? tasks.filter(t => t.category === activeFilter)
                : tasks;

            const completedCount = tasks.filter(t => t.completed).length;

            return (
                <div className="min-h-screen py-8 px-4">
                    <div className="max-w-2xl mx-auto">
                        {/* Header */}
                        <div className="text-center mb-8">
                            <h1 className="text-4xl font-bold text-white mb-2 drop-shadow-lg">
                                ‚ú® Task Board
                            </h1>
                            <p className="text-white/80">
                                Stay organized, stay productive
                            </p>
                        </div>

                        {/* Main Card */}
                        <div className="glass rounded-2xl p-6 shadow-2xl">
                            {/* Error Message */}
                            {error && (
                                <div className="mb-4 p-3 bg-red-100 text-red-700 rounded-lg flex justify-between items-center">
                                    <span>{error}</span>
                                    <button onClick={() => setError(null)} className="text-red-500 hover:text-red-700">√ó</button>
                                </div>
                            )}

                            {/* Progress Bar */}
                            <ProgressBar progress={progress} />

                            {/* Task Input */}
                            <TaskInput onAddTask={handleAddTask} loading={loading} />

                            {/* Category Filter - UNIQUE FEATURE */}
                            {Object.keys(categoryStats).length > 0 && (
                                <CategoryFilter 
                                    categoryStats={categoryStats}
                                    activeFilter={activeFilter}
                                    onFilterChange={setActiveFilter}
                                />
                            )}

                            {/* Task List */}
                            <div className="mt-4">
                                {filteredTasks.length === 0 ? (
                                    <EmptyState />
                                ) : (
                                    <>
                                        {filteredTasks.map(task => (
                                            <TaskItem
                                                key={task.id}
                                                task={task}
                                                onToggle={handleToggleTask}
                                                onDelete={handleDeleteTask}
                                                loading={loading}
                                            />
                                        ))}
                                    </>
                                )}
                            </div>

                            {/* Clear Completed Button */}
                            {completedCount > 0 && (
                                <div className="mt-4 pt-4 border-t border-gray-200">
                                    <button
                                        onClick={handleClearCompleted}
                                        className="text-sm text-gray-500 hover:text-red-500 transition-colors"
                                    >
                                        üóëÔ∏è Clear {completedCount} completed task{completedCount !== 1 ? 's' : ''}
                                    </button>
                                </div>
                            )}
                        </div>

                        {/* Footer */}
                        <div className="text-center mt-6 text-white/60 text-sm">
                            Made with üíú by Rohit Singh ‚Ä¢ Task Board v1.0
                        </div>
                    </div>
                </div>
            );
        };

        // Render App
        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>